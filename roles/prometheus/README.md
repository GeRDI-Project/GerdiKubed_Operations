# Prometheus Monitoring System

This role deploys the prometheus monitoring system to the k8s cluster. The system is only monitoring metrics which are 
exportet by kublet for each node. Further instrumentations has to be adjusted by an individual config map. Documentation 
on prometheus configurations can be found at [http://prometheus.io](https://prometheus.io/docs/introduction/overview/).

## Installed components

- A prometheus master server (prometheus-server) which collects metrics from predefined endpoints

## Editable Variables and Defaults

| Name                      | Default           | Description                                                                   |
| ------------------------- | ----------------- | ----------------------------------------------------------------------------- |
| PROMETHEUS_BASE_DIR       | /opt/prometheus   | Base directory with k8s configuration files                                   |
| PROMETHEUS_SERVER_VERSION | 2.9.1             | The version of the prometheus master server                                   |

## Usage Custom configMaps

### Prometheus Master Server configMap

The deployment uses a default configuration which is currently monitoring endpoints that are listed in the table
below. This list will be extended in further releases. However, it will not be possible to cover every possible
configuration. Hence, either you use a custom configMap or adjust your deployments.

| Name              | Endpoint                                          | Description                                       |
| ----------------- | ------------------------------------------------- | ------------------------------------------------- |
| POD/prometheus    | htto://localhost:9090/admin/prometheus/metrics    | Metrics generated by the prometheus server        |
| NODE/kubelt       | https://<node-ip>:10250/metrics                   | Metrics generated by kubelt on any k8s node       |

## Reaching Prometheus Master Outside the Cluster

The prometheus server can be reached from outside the cluster. This allows to monitor multiple k8s clusters using a
single prometheus of grafana instance. The endpoint which is exposed by k8s is https://<lb-ip>/admin/prometheus. To
prevent unitended access, it is seccured by Basic Auth. The according username and password must be requested from the
cluster admin.

## Maintainer

- Alexander Goetz [LRZ] (2019 - )
