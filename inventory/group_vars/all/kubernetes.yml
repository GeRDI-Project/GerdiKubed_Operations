# Copyright 2019 Alexander Goetz goetz@lrz.de
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

K8S_DEPLOYMENT_CONTEXT: # Domain prefix
K8S_DOMAIN_NAMESPACE:   # Domain to reach the cluster
MAIN_DOMAIN:            # Main domain to the reach the cluster loadbalancer/gateway maschine
OTHER_DOMAINS:
  - "{{K8S_DEPLOYMENT_CONTEXT}}.{{K8S_DOMAIN_NAMESPACE}}"
K8S_GLOBAL_LOG_LEVEL:   "v=1"
K8S_MASTER_DOMAIN:      "{{ 'mstr-0.' + K8S_DEPLOYMENT_CONTEXT + '.' + K8S_DOMAIN_NAMESPACE }}"
K8S_MASTER_IP:          "{{ hostvars[K8S_MASTER_DOMAIN]['altIP'] | default(lookup('dig', K8S_MASTER_DOMAIN)) }}"
K8S_BASE_DIR:           /opt/k8s
K8S_K8S_DIR:            "{{ K8S_BASE_DIR }}/kubernetes"
K8S_SERVER_BIN_DIR:     "{{ K8S_K8S_DIR }}/server/kubernetes/server/bin"
K8S_KUBECONFIG:         "{{ K8S_BASE_DIR }}/kubeconfig"
K8S_DOWNLOAD_URL:       "https://github.com/kubernetes/kubernetes/releases/download/{{K8S_VERSION}}/kubernetes.tar.gz"

################################################################################
# Configuration for the following roles:
# apiserver, common, controller-manager, etcd, k8s-binaries kubelet, network-ovn
################################################################################
K8S_CERT_FILES_DIR:     "{{ K8S_BASE_DIR }}/certs"
K8S_KEY_FILES_DIR:      "{{ K8S_BASE_DIR }}/keys"
K8S_AUTH_FILES_DIR:     "{{ K8S_BASE_DIR }}/tokens"

################################################################################
# Configuration for the following roles:
# apiserver, cert-infrastructure, controller-manager, kube-proxy, network-ovn
################################################################################
K8S_CLUSTER_IP_PRE:     "10.220"
K8S_CLUSTER_IP_SUBNET:  "{{ K8S_CLUSTER_IP_PRE }}.0.0/15"
K8S_SERVICE_IP_PRE:     "10.222"
K8S_SERVICE_IP_SUBNET:  "{{ K8S_SERVICE_IP_PRE }}.0.0/16"
K8S_DNS_IP:             "{{ K8S_SERVICE_IP_PRE }}.0.10"

################################################################################
# Configuration for Docker Container Engine
################################################################################
DOCKER_NAMESERVER:      "{{ NODE_NAMESERVER }}"
DOCKER_MTU:             "{{ NETWORK_MTU }}" # Only change if network MTU < 1500

################################################################################
# Configuration for cert-infrastructure role
################################################################################
CONTROL_MACHINE:        "127.0.0.1"
CONTROL_CERT_DIR:       "{{ CONTROL_BASE_DIR }}/certs"
CONTROL_KEY_DIR:        "{{ CONTROL_BASE_DIR }}/keys"
CONTROL_CONFIG_DIR:     "{{ CONTROL_BASE_DIR }}/configs"
CONTROL_CSR_DIR:        "{{ CONTROL_BASE_DIR }}/csrs"
CONTROL_CA_DIR:         "{{ CONTROL_BASE_DIR }}/ca"
